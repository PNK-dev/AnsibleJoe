# Configuración fail2ban para Proyecto SO
# Generado automáticamente por Ansible

[DEFAULT]
# Configuración global
bantime = 3600
findtime = 600
maxretry = 3
backend = systemd
usedns = warn
logencoding = auto
enabled = false
mode = normal
filter = %(__name__)s[mode=%(mode)s]

# Configuración de notificaciones
destemail = root@{{ network_domain | default('localhost') }}
sendername = Fail2Ban-ProyectoSO
mta = sendmail
protocol = tcp
chain = <known/chain>
port = 0:65535
fail2ban_agent = Fail2Ban/%(fail2ban_version)s

# Acciones por defecto
banaction = firewallcmd-ipset
banaction_allports = firewallcmd-allports
action_ = %(banaction)s[name=%(__name__)s, bantime="%(bantime)s", port="%(port)s", protocol="%(protocol)s", chain="%(chain)s"]
action_mw = %(banaction)s[name=%(__name__)s, bantime="%(bantime)s", port="%(port)s", protocol="%(protocol)s", chain="%(chain)s"]
            %(mta)s-whois[name=%(__name__)s, sender="%(sendername)s", dest="%(destemail)s", protocol="%(protocol)s", chain="%(chain)s"]
action_mwl = %(banaction)s[name=%(__name__)s, bantime="%(bantime)s", port="%(port)s", protocol="%(protocol)s", chain="%(chain)s"]
             %(mta)s-whois-lines[name=%(__name__)s, sender="%(sendername)s", dest="%(destemail)s", logpath="%(logpath)s", chain="%(chain)s"]
action = %(action_)s

# Protección SSH
[sshd]
enabled = true
port = ssh
logpath = %(sshd_log)s
backend = %(sshd_backend)s
maxretry = 3
bantime = 1800

# Protección HTTP/Apache
[apache-auth]
enabled = true
port = http,https
logpath = /var/log/httpd/error_log
maxretry = 5
bantime = 3600

[apache-badbots]
enabled = true
port = http,https
logpath = /var/log/httpd/access_log
bantime = 86400
maxretry = 1

[apache-noscript]
enabled = true
port = http,https
logpath = /var/log/httpd/access_log
maxretry = 6
bantime = 86400

[apache-overflows]
enabled = true
port = http,https
logpath = /var/log/httpd/error_log
maxretry = 2
bantime = 86400

# Protección FTP
[vsftpd]
enabled = true
port = ftp,ftp-data,ftps,ftps-data
logpath = /var/log/vsftpd.log
maxretry = 3
bantime = 3600

# Protección DNS
[named-refused]
enabled = true
port = domain,953
logpath = /var/log/messages
filter = named-refused
maxretry = 5
bantime = 86400

# Protección general del sistema
[systemd]
enabled = true
journalmatch = _SYSTEMD_UNIT=sshd.service + _COMM=sshd
backend = systemd
maxretry = 3
bantime = 3600

# Protección contra ataques de fuerza bruta
[recidive]
enabled = true
logpath = /var/log/fail2ban.log
banaction = %(banaction_allports)s
bantime = 604800
findtime = 86400
maxretry = 5

# Filtro personalizado para el proyecto SO
[proyecto-so-custom]
enabled = true
port = http,https,ftp,ssh
logpath = /var/log/messages
filter = proyecto-so-custom
maxretry = 10
bantime = 7200
findtime = 3600